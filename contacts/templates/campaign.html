<!-- campaign_page.html -->
{% extends 'base.html' %}

{% block title %}
    <title>Campaigns</title>
{% endblock %}

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

{% block content %}
    <div class="ml-2">
        <!-- Form for selecting a campaign -->
        <div class="d-flex align-items-center">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="viewCampaignDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                View Specific Campaign
            </button>
            <div class="dropdown-menu" aria-labelledby="viewCampaignDropdown">
                <!-- Hardcoded campaign names -->
                <a class="dropdown-item view-campaign" id="Django Campaign" href="#">Django Campaign</a>
                <a class="dropdown-item view-campaign" id="Django Campaign 2" href="#">Django Campaign 2</a>
            </div>
        </div>
        <button class="btn btn-info ml-3" id="viewAllButton">View All Campaigns</button>
    </div>

    <div id="campaignContent" class="mt-3">
        <h2>Campaign Details</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Campaign Name</th>
                </tr>
            </thead>
            <tbody id="campaignEmailsTableBody">
                <!-- Dynamic content for campaign emails -->
                {% for email_entry in campaign_emails %}
                    <tr data-campaign="{{ email_entry.campaign_name }}">
                        <td>{{ email_entry.user.username }}</td>
                        <td>{{ email_entry.email }}</td>
                        <td>{{ email_entry.campaign_name }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function filterCampaignTable(campaignName) {
            const tableRows = document.querySelectorAll('#campaignEmailsTableBody tr');
            tableRows.forEach(row => {
                if (row.getAttribute('data-campaign') === campaignName) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function viewAllCampaigns() {
            const tableRows = document.querySelectorAll('#campaignEmailsTableBody tr');
            tableRows.forEach(row => {
                row.style.display = '';
            });
        }

        function initEventListeners() {
            document.querySelectorAll('.view-campaign').forEach(item => {
                item.addEventListener('click', function(event) {
                    event.preventDefault();
                    const campaign = this.getAttribute('id');
                    filterCampaignTable(campaign);
                });
            });

            const viewCampaignDropdown = document.getElementById('viewCampaignDropdown');
            viewCampaignDropdown.addEventListener('click', function(event) {
                event.preventDefault();
                const campaignMenu = document.querySelector('[aria-labelledby="viewCampaignDropdown"]');
                campaignMenu.classList.toggle('show');
            });

            const viewAllButton = document.getElementById('viewAllButton');
            viewAllButton.addEventListener('click', function(event) {
                event.preventDefault();
                viewAllCampaigns();
            });

            window.addEventListener('click', function(event) {
                if (!event.target.matches('.dropdown-toggle')) {
                    const dropdowns = document.querySelectorAll('.dropdown-menu');
                    dropdowns.forEach(dropdown => {
                        if (dropdown.classList.contains('show')) {
                            dropdown.classList.remove('show');
                        }
                    });
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners(); // Initialize event listeners
        });
    </script>
{% endblock %}
